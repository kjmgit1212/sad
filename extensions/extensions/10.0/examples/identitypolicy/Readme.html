<html>

<head>
<title>Running the Identity Policy Extensions example.</title>
<link rel=Stylesheet type="text/css" media=all href="../examples.css">

<![if mso 9]>
<style>
p.MsoNormal
	{margin-left:52.5pt;}
</style>
<![endif]>
</head>

<body bgcolor=white lang=EN-US link="#0000CC" vlink="#660099" style='margin-left:
52.5pt;margin-top:24.0pt;margin-right:12.0pt;margin-bottom:24.0pt'>

<div class=Section1>

<table  border=0 cellspacing=0 cellpadding=0 width="100%"
 style='width:100.0%'>
 <tr>
  <td style='padding:0in 0in 0in 0in'>
  <p  style='margin:0in;margin-bottom:.0001pt'><span
  style='font-family:"Arial","sans-serif";color:black'><img width=283
  height=58 src="../ibm_banner.gif"></span></p>
  </td>
  <td style='padding:0in 0in 0in 0in'>
  <p  align=right style='margin:0in;margin-bottom:.0001pt;
  text-align:right'><span style='font-family:"Arial","sans-serif";color:black'><img
  width=347 height=46 src="../tivolilogo.gif"></span></p>
  </td>
 </tr>
</table>

<h1>Automatic Identity Policy Extension Example.</h1>

<p  style='margin:0in;margin-bottom:.0001pt'><span
style='font-family:"Arial","sans-serif";color:black'>&nbsp;</span></p>

<h2>Contents</h2>

<p  style='margin-top:0in;margin-right:0in;margin-bottom:12.0pt;
margin-left:0in'><span style='font-family:"Arial","sans-serif";color:black'><br>
<a href="#Purpose_of_this_Document">Purpose of this Document </a><br>
<a href="#Usage">Usage</a> <br>
<a href="#Implementation_overview">Implementation Overview</a> <br>
<a href="#Deploy_extension">Building and deploying the extension</a> <a
name="Purpose_of_this_Document"></a></span></p>

<h2>Purpose of this Document</h2>

<p  style='margin:0in;margin-bottom:.0001pt'><span
style='font-family:"Arial","sans-serif";color:black'>The purpose of this
example is to provide an Identity Policy extension, which when used from the
Identity Policy java script, prevents generation of duplicate identifiers,
during Automatic Provisioning policy enforcement.</span></p>

<p><span style='font-family:"Arial","sans-serif";color:black'>This extension is
particularly useful when the Identity Policy definition logic, does not
guarantee generation of a unique identifier for an account, which is also
unique to the owner Person/BPPerson entity. </span></p>

<p><span style='font-family:"Arial","sans-serif";color:black'>This example is
designed to be simple while solving a problem, but does not scale well. For
example, in a clustered environment two nodes would be able to generate the
same user id using this code. <a name=Usage></a></span></p>

<h2>Usage</h2>

<p  style='margin:0in;margin-bottom:.0001pt'><span
style='font-family:"Arial","sans-serif";color:black'>This example publishes the
function 'getNextCount' to the interpreter. This function takes two input
parameters:<br>
1. Base Identity.......This argument is the baseIdentity generated by the
Identity Policy java script.<br>
2. Service Identifier..This argument uniquely identifies the service used to
provision the account.<br>
<br>
When invoked, this function returns an integer value. A value of '-2' indicates
that an exception had occurred, when the extension was executed. A value of
'-1' indicates that the 'Base Identity' has never been used for the service. A
value &gt;= 1 returned by the function indicates an unused counter for the
'Base Identity' for the service. The counter returned, needs to be appended to
the 'Base Identity' in the Identity Policy Java Script, if not -1. An empty
string should be returned by the Identity Policy Java Script, when the counter
returned is -2.<br>
To illustrate the usage of 'getNextCount(baseIdentity, serviceId)', consider
the following JavaScript snippet: </span></p>

<pre><span style='color:black'>&nbsp;</span></pre><pre><span style='color:black'>function createAutoIdentity() {</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; // Logic for creating base Identity</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; var sn = subject.getProperty(&quot;sn&quot;)[0];</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; var cn = subject.getProperty(&quot;cn&quot;)[0];</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; var baseIdentity = cn.substring(0,1) + sn;</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; var serviceId =&nbsp; service.getProperty(&quot;erglobalid&quot;)[0];</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; </span></pre><pre><span style='color:black'>&nbsp;&nbsp;&nbsp;// Get the next available counter for baseIdentity</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; var cnt = getNextCount(baseIdentity, serviceId);</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; if(cnt == -2) {</span></pre><pre><span
style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;&quot;;</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; }</span></pre><pre><span style='color:black'>&nbsp;&nbsp; </span></pre><pre><span
style='color:black'>&nbsp;&nbsp;&nbsp;if (cnt == -1) {</span></pre><pre><span
style='color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return baseIdentity;</span></pre><pre><span
style='color:black'>&nbsp;&nbsp; }</span></pre><pre><span style='color:black'>&nbsp;&nbsp; </span></pre><pre><span
style='color:black'>&nbsp;&nbsp;&nbsp;return baseIdentity + cnt;</span></pre><pre><span
style='color:black'>}</span></pre><pre><span style='color:black'>&nbsp;</span></pre><pre><span
style='color:black'>return createAutoIdentity();</span></pre>

<p  style='margin:0in;margin-bottom:.0001pt'><span
style='font-family:"Arial","sans-serif";color:black'>Consider a person with
cn=James Smith and sn=Smith, then the above snippet would return 'JSmith' if
there are no accounts with the id 'JSmith' for the particular service, or will
return 'JSmithX', where 'X' is a number &gt;= 1, such that 'JSmithX' is a
non-existent or un-used (Not pending for account creation) account ID for the
given service. If an exception occurs ( -2 returned by 'getNextCount()' ), then
the above snippet will return an empty string, prompting the ISIM user to fill
in the 'Account ID' field. <a name="Implementation_overview"></a></span></p>

<h2>Implementation Overview</h2>

<p  style='margin:0in;margin-bottom:.0001pt'><span
style='font-family:"Arial","sans-serif";color:black'>The example contains the
following source files :- </span></p>

<ul type=disc>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>AutomaticIDExtension.java
     - This is the main source file which publishes the function 'getNextCount'
     to the interpreter. This class uses AutomaticIDBean to do all of the work.
     </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>AutomaticIDBean.java
     - This class implements the functionality of 'getNextCount'. It is a best
     practice to put the code that implements a scripting function in a
     seperate class that knows nothing about the scripting framework provided
     by ISIM. </span></li>
</ul>

<h2><a name="Deploy_extension"></a>Building and deploying the extension </h2>

<ol start=1 type=1>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>To
     avoid debugging statements from the example set the static variable
     'DEBUG' in AutomaticIDBean.java to false. </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>Build
     the example (see <a href="../Building.html">Building the Examples</a>). </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>Add
     the <dfn><span style='font-family:"Arial","sans-serif"'>examples.jar</span></dfn>
     file created by the build process to the application server's classpath by
     following the instructions given in <a href="../Classpath.html">Adding <dfn><span
     style='font-family:"Arial","sans-serif"'>examples.jar</span></dfn> to
     Classpath</a>. </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>Update
     the scriptframework.properties file (see <a
     href="../Updating_property_files.html">Updating the property files</a>)
     present in the data folder, by adding the following line: <i>ITIM.extension.IdentityPolicy.sample=examples.itim50.identitypolicy.AutomaticIDExtension</i>
     </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>Start
     the ISIM server. </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>In
     an enabled Identity Policy, use the 'getNextCount' function as illustrated
     in the code snippet above. </span></li>
 <li  style='color:black'><span style='font-family:"Arial","sans-serif"'>Attempt
     to provision an account for a user where the user id of the account is
     governed by the Identity Policy and confirm expected results. </span></li>
</ol>

</div>

</body>

</html>
